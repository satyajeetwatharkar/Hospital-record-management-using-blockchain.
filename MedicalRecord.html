<html>
<head>
<title>Patient Medical Record details</title>
<link rel="stylesheet" href="styles.css">
<!-- CSS only -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-eOJMYsd53ii+scO/bJGFsiCZc+5NDVN2yr8+0RDqr0Ql0h+rP48ckxlpbzKgwra6" crossorigin="anonymous">
</head>
    <body>

        <script src="https://cdn.jsdelivr.net/npm/web3@1.2.8/dist/web3.js"></script>
    <script>

      var account;
    	window.addEventListener('load', async () => {


    		if (typeof window.ethereum !== 'undefined') {
    			console.log("MetaMask is Available :) !");
    			}

    		// Modern DApp browsers
    		if (window.ethereum) {
    			window.web3 = new Web3(ethereum);

    			// To prevent the page reloading when the MetaMask network changes
    			ethereum.autoRefreshOnNetworkChange = false;

    			// To Capture the account details from MetaMask
    			const accounts = await ethereum.enable();
    			account = accounts[0];
    			console.log(account);

    			}
    		// Legacy DApp browsers
    		else if (window.web3) {
    			window.web3 = new Web3(web3.currentProvider);

    			}
    		// Non-DApp browsers
    		else {
    			console.log('Non-Ethereum browser detected. Please install MetaMask');
    			}

    			});

        var abi = [
          {
            "constant": false,
            "inputs": [
              {
                "internalType": "uint256",
                "name": "patient_id",
                "type": "uint256"
              },
              {
                "internalType": "string",
                "name": "_applicable",
                "type": "string"
              },
              {
                "internalType": "uint64",
                "name": "_policy_no",
                "type": "uint64"
              },
              {
                "internalType": "string",
                "name": "_insurer",
                "type": "string"
              },
              {
                "internalType": "string",
                "name": "_policy_type",
                "type": "string"
              },
              {
                "internalType": "string",
                "name": "_policy_limit",
                "type": "string"
              }
            ],
            "name": "insurance_details",
            "outputs": [],
            "payable": false,
            "stateMutability": "nonpayable",
            "type": "function"
          },
          {
            "constant": true,
            "inputs": [
              {
                "internalType": "uint256",
                "name": "patient_id",
                "type": "uint256"
              }
            ],
            "name": "get_insurance",
            "outputs": [
              {
                "internalType": "string",
                "name": "",
                "type": "string"
              },
              {
                "internalType": "uint64",
                "name": "",
                "type": "uint64"
              },
              {
                "internalType": "string",
                "name": "",
                "type": "string"
              },
              {
                "internalType": "string",
                "name": "",
                "type": "string"
              },
              {
                "internalType": "string",
                "name": "",
                "type": "string"
              }
            ],
            "payable": false,
            "stateMutability": "view",
            "type": "function"
          },
          {
            "constant": false,
            "inputs": [
              {
                "internalType": "uint256",
                "name": "patient_id",
                "type": "uint256"
              },
              {
                "internalType": "string",
                "name": "_complaints",
                "type": "string"
              },
              {
                "internalType": "string",
                "name": "_duration",
                "type": "string"
              }
            ],
            "name": "present_illness",
            "outputs": [],
            "payable": false,
            "stateMutability": "nonpayable",
            "type": "function"
          },
          {
            "constant": true,
            "inputs": [
              {
                "internalType": "uint256",
                "name": "patient_id",
                "type": "uint256"
              }
            ],
            "name": "get_present_illness",
            "outputs": [
              {
                "internalType": "string",
                "name": "",
                "type": "string"
              },
              {
                "internalType": "string",
                "name": "",
                "type": "string"
              }
            ],
            "payable": false,
            "stateMutability": "view",
            "type": "function"
          },
          {
            "constant": false,
            "inputs": [
              {
                "internalType": "uint256",
                "name": "patient_id",
                "type": "uint256"
              },
              {
                "internalType": "string",
                "name": "_family_history",
                "type": "string"
              },
              {
                "internalType": "string",
                "name": "_personal_history",
                "type": "string"
              },
              {
                "internalType": "string",
                "name": "_drug_history",
                "type": "string"
              }
            ],
            "name": "past_illness",
            "outputs": [],
            "payable": false,
            "stateMutability": "nonpayable",
            "type": "function"
          },
          {
            "constant": true,
            "inputs": [
              {
                "internalType": "uint256",
                "name": "patient_id",
                "type": "uint256"
              }
            ],
            "name": "get_past_illness",
            "outputs": [
              {
                "internalType": "string",
                "name": "",
                "type": "string"
              },
              {
                "internalType": "string",
                "name": "",
                "type": "string"
              },
              {
                "internalType": "string",
                "name": "",
                "type": "string"
              }
            ],
            "payable": false,
            "stateMutability": "view",
            "type": "function"
          },
          {
            "constant": false,
            "inputs": [
              {
                "internalType": "uint256",
                "name": "patient_id",
                "type": "uint256"
              },
              {
                "internalType": "string",
                "name": "_diag_summary",
                "type": "string"
              },
              {
                "internalType": "string",
                "name": "_prescription",
                "type": "string"
              }
            ],
            "name": "func_diagnosis",
            "outputs": [],
            "payable": false,
            "stateMutability": "nonpayable",
            "type": "function"
          },
          {
            "constant": true,
            "inputs": [
              {
                "internalType": "uint256",
                "name": "patient_id",
                "type": "uint256"
              }
            ],
            "name": "get_func_diagnosis",
            "outputs": [
              {
                "internalType": "string",
                "name": "",
                "type": "string"
              },
              {
                "internalType": "string",
                "name": "",
                "type": "string"
              }
            ],
            "payable": false,
            "stateMutability": "view",
            "type": "function"
          },
          {
            "constant": false,
            "inputs": [
              {
                "internalType": "uint256",
                "name": "patient_id",
                "type": "uint256"
              },
              {
                "internalType": "string",
                "name": "_treatment",
                "type": "string"
              },
              {
                "internalType": "string",
                "name": "_date_treatment",
                "type": "string"
              },
              {
                "internalType": "uint256",
                "name": "_doctor_id",
                "type": "uint256"
              },
              {
                "internalType": "uint256",
                "name": "_hospital_id",
                "type": "uint256"
              },
              {
                "internalType": "string",
                "name": "_discharge",
                "type": "string"
              },
              {
                "internalType": "string",
                "name": "_follow_up",
                "type": "string"
              }
            ],
            "name": "treatment_summary",
            "outputs": [],
            "payable": false,
            "stateMutability": "nonpayable",
            "type": "function"
          },
          {
            "constant": true,
            "inputs": [
              {
                "internalType": "uint256",
                "name": "patient_id",
                "type": "uint256"
              }
            ],
            "name": "get_treatment_summary",
            "outputs": [
              {
                "internalType": "string",
                "name": "",
                "type": "string"
              },
              {
                "internalType": "string",
                "name": "",
                "type": "string"
              },
              {
                "internalType": "uint256",
                "name": "",
                "type": "uint256"
              },
              {
                "internalType": "uint256",
                "name": "",
                "type": "uint256"
              },
              {
                "internalType": "string",
                "name": "",
                "type": "string"
              },
              {
                "internalType": "string",
                "name": "",
                "type": "string"
              }
            ],
            "payable": false,
            "stateMutability": "view",
            "type": "function"
          }
        ];
        var contractaddress = '0x674d55683113979cC420BbAb76212FA118506781';

				function submit_details() {
            var myContract = new web3.eth.Contract(abi,contractaddress, {from: account, gasPrice: '5000000', gas: '5000000'});
			var id = document.getElementById("id1").value;
			var ids1 = document.getElementById("appl").value;
			var ids2 = document.getElementById("pono").value;
			var ids3 = document.getElementById("ins").value;
			var ids4 = document.getElementById("type").value;
			var ids5 = document.getElementById("lim").value;

			var pd1 = document.getElementById("com").value;
			var pd2 = document.getElementById("dur").value;

			var pad1 = document.getElementById("fam").value;
			var pad2 = document.getElementById("per").value;
			var pad3 = document.getElementById("drug").value;

			var dd1 = document.getElementById("diag").value;
			var dd2 = document.getElementById("pre").value;

			var td1 = document.getElementById("treat").value;
			var td2 = document.getElementById("date").value;
			var td3 = document.getElementById("doc").value;
			var td4 = document.getElementById("hos").value;
			var td5 = document.getElementById("dis").value;
			var td6 = document.getElementById("fol").value;




             var result = myContract.methods.insurance_details(id,ids1,ids2,ids3,ids4,ids5).send(function (err, result) {

                if (err) { console.log(err); }

                });

             var result = myContract.methods.present_illness(id,pd1,pd2).send(function (err, result) {

                if (err) { console.log(err); }

                });


             var result = myContract.methods.past_illness(id,pad1,pad2,pad3).send(function (err, result) {

                if (err) { console.log(err); }

                });


             var result = myContract.methods.func_diagnosis(id,dd1,dd2).send(function (err, result) {

                if (err) { console.log(err); }

                });


             var result = myContract.methods.treatment_summary(id,td1,td2,td3,td4,td5,td6).send(function (err, result) {

                if (err) { console.log(err); }

                });
        }

        </script>

       <h2>Previous dates of medical record updated</h2>
    <form>
		<table style="width:25%">
            <tr>
			<td>Enter Patient Id:</td>
			<td><input type="text" id="id1" name="id1"></td>
		  </tr>
		</table>
	</form>
        <h2>Insurance Details</h2>
    <form>
		<table style="width:25%">

            <tr>
			<td> Is Insurance applicable?(yes/no):</td>
			<td><input type="text" id="appl" name="appl"></td>
		  </tr>
		  <tr>
			<td>Policy Number:</td>
			<td><input type="text" id="pono" name="pono"></td>
		  </tr>

		   <tr>
			<td>Insurer:</td>
			<td><input type="text" id="ins" name="ins"></td>
		  </tr>
            <tr>
			<td>Policy Type:</td>
			<td><input type="text" id="type" name="type"></td>
		  </tr>
		  <tr>
			<td>Policy Limit:</td>
			<td><input type="text" id="lim" name="lim"></td>
		  </tr>

		</table>


	</form>
	<h2> Present Illness Details</h2>
    <form>
		<table style="width:25%">

            <tr>
			<td> Complaints:</td>
			<td><input type="text" id="com" name="com"></td>
		  </tr>
		  <tr>
			<td>Duation:</td>
			<td><input type="text" id="dur" name="dur"></td>
		  </tr>
		</table>

	</form>
	<h2> Past Illness Details</h2>
    <form>
		<table style="width:25%">

            <tr>
			<td> Family History:</td>
			<td><input type="text" id="fam" name="fam"></td>
		  </tr>
		  <tr>
			<td>Personal History:</td>
			<td><input type="text" id="per" name="per"></td>
		  </tr>
		  <tr>
			<td>Drug History:</td>
			<td><input type="text" id="drug" name="drug"></td>
		  </tr>
		</table>

	</form>
	<h2>Provisional Diagnosis Details</h2>
    <form>
		<table style="width:25%">

            <tr>
			<td> Diagnosis Summary:</td>
			<td><input type="text" id="diag" name="diag"></td>
		  </tr>
		  <tr>
			<td>Prescription:</td>
			<td><input type="text" id="pre" name="pre"></td>
		  </tr>
		</table>

	</form>

        <h2>Treatment Summary</h2>
    <form>
		<table style="width:25%">

            <tr>
			<td> Treatment:</td>
			<td><input type="text" id="treat" name="treat"></td>
		  </tr>
		  <tr>
			<td>Date of Treatment:</td>
			<td><input type="text" id="date" name="date"></td>
		  </tr>

		   <tr>
			<td>Treated Doctor Id:</td>
			<td><input type="text" id="doc" name="doc"></td>
		  </tr>
            <tr>
			<td>Treated Hospital Id:</td>
			<td><input type="text" id="hos" name="hos"></td>
		  </tr>
		  <tr>
			<td>Discharge:</td>
			<td><input type="text" id="dis" name="dis"></td>
		  </tr>
			<tr>
			<td>Follow Up:</td>
			<td><input type="text" id="fol" name="fol"></td>
		  </tr>
		</table>

	</form>

		 <form>
		<table style="width:25%">
		<tr>
		  <td><input type="button" onclick="submit_details()" value="Submit"></td>
		  </tr>
		  </table>

	</form>
    </body>
</html>
